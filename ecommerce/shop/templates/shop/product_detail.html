{% extends 'shop/base.html' %} {% load static %} {% block content %}
<!-- Hidden data element for JavaScript -->
<div
  id="productData"
  data-price="{{ product.price|default:'129.99' }}"
  data-name="{{ product.name|default:'Premium Wireless Headphones' }}"
  style="display: none"
></div>

<div class="container py-5">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">Home</a></li>
      <li class="breadcrumb-item"><a href="/products/">Products</a></li>
      <li class="breadcrumb-item active" aria-current="page">
        {{ product.name|default:"Premium Wireless Headphones" }}
      </li>
    </ol>
  </nav>

  <div class="row">
    <!-- Product Images -->
    <div class="col-lg-6">
      <div class="product-image-main mb-4">
        <img
          src="{{ product.image_url|default:'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80' }}"
          class="img-fluid rounded-lg shadow-lg"
          alt="{{ product.name|default:'Product' }}"
          id="mainProductImage"
          style="max-height: 500px; width: 100%; object-fit: cover;"
        />
      </div>

      <div class="product-image-thumbnails d-flex gap-3">
        <div
          class="thumbnail active"
          onclick="
            changeImage(
              this,
              'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=400&fit=crop',
            )
          "
        >
          <img
            src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=100&h=100&fit=crop"
            class="rounded cursor-pointer"
            alt="Front View"
          />
        </div>
        <div
          class="thumbnail"
          onclick="
            changeImage(
              this,
              'https://images.unsplash.com/photo-1484704849700-f032a568e944?w=400&h=400&fit=crop',
            )
          "
        >
          <img
            src="https://images.unsplash.com/photo-1484704849700-f032a568e944?w=100&h=100&fit=crop"
            class="rounded cursor-pointer"
            alt="Side View"
          />
        </div>
        <div
          class="thumbnail"
          onclick="
            changeImage(
              this,
              'https://images.unsplash.com/photo-1487215078519-e21cc028cb29?w=400&h=400&fit=crop',
            )
          "
        >
          <img
            src="https://images.unsplash.com/photo-1487215078519-e21cc028cb29?w=100&h=100&fit=crop"
            class="rounded cursor-pointer"
            alt="In Use"
          />
        </div>
        <div
          class="thumbnail"
          onclick="
            changeImage(
              this,
              'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=400&fit=crop',
            )
          "
        >
          <img
            src="https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?w=100&h=100&fit=crop"
            class="rounded cursor-pointer"
            alt="Package"
          />
        </div>
      </div>
    </div>

    <!-- Product Details -->
    <div class="col-lg-6">
      <div class="product-details">
        <!-- Category & Badge -->
        <div class="d-flex align-items-center gap-3 mb-3">
          <span class="category-badge"
            >{{ product.category|default:"Electronics" }}</span
          >
          <span class="badge bg-success">
            <i class="fas fa-bolt me-1"></i>Bestseller
          </span>
          <span class="badge bg-warning">
            <i class="fas fa-truck me-1"></i>Free Shipping
          </span>
        </div>

        <!-- Product Title -->
        <h1 class="product-title mb-3">
          {{ product.name|default:"Premium Wireless Headphones" }}
        </h1>

        <!-- Rating -->
        <div class="product-rating mb-4">
          <div class="stars text-warning mb-2">
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star"></i>
            <i class="fas fa-star-half-alt"></i>
            <span class="ms-2 text-dark">4.5</span>
            <span class="text-muted">(128 reviews)</span>
          </div>
          <div class="d-flex align-items-center gap-4">
            <span class="text-success">
              <i class="fas fa-check-circle me-1"></i>In Stock
            </span>
            <span class="text-muted">
              <i class="fas fa-shopping-cart me-1"></i>324 sold this week
            </span>
          </div>
        </div>

        <!-- Price -->
        <div class="product-price mb-4">
          <h2 class="display-4 fw-bold text-primary mb-1">
            £{{ product.price|default:"129.99" }}
          </h2>
          <p class="text-muted mb-0">
            <s class="text-danger">£179.99</s>
            <span class="ms-2 badge bg-danger">Save £50</span>
          </p>
          <p class="text-success small mb-0">
            <i class="fas fa-percentage me-1"></i>Buy now & get 10% off your
            next purchase
          </p>
        </div>

        <!-- Product Description -->
        <div class="product-description mb-5">
          <h4 class="mb-3">Product Description</h4>
          <p>
            {{ product.description|default:"Experience premium sound quality
            with our state-of-the-art wireless headphones. Featuring active
            noise cancellation, 30-hour battery life, and crystal clear call
            quality. Perfect for work, travel, and entertainment." }}
          </p>
          <ul class="list-unstyled">
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              Premium noise-cancelling technology
            </li>
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              30-hour battery life with quick charge
            </li>
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              Crystal clear call quality
            </li>
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              Comfort-fit design for extended wear
            </li>
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              2-year manufacturer warranty
            </li>
          </ul>
        </div>

        <!-- Color Options -->
        <div class="product-options mb-4">
          <h5 class="mb-3">Color Options</h5>
          <div class="d-flex gap-3">
            <div class="color-option active" data-color="black">
              <div class="color-circle" style="background-color: #000"></div>
              <span class="small">Black</span>
            </div>
            <div class="color-option" data-color="silver">
              <div class="color-circle" style="background-color: #c0c0c0"></div>
              <span class="small">Silver</span>
            </div>
            <div class="color-option" data-color="blue">
              <div class="color-circle" style="background-color: #2563eb"></div>
              <span class="small">Blue</span>
            </div>
            <div class="color-option" data-color="red">
              <div class="color-circle" style="background-color: #dc2626"></div>
              <span class="small">Red</span>
            </div>
          </div>
        </div>

        <!-- Add to Cart Section -->
        <div class="add-to-cart-section mb-5">
          <div class="row g-3">
            <div class="col-md-4">
              <div class="input-group">
                <button
                  class="btn btn-outline-secondary quantity-btn"
                  type="button"
                  onclick="updateQuantity(-1)"
                >
                  <i class="fas fa-minus"></i>
                </button>
                <input
                  type="text"
                  class="form-control text-center quantity-input"
                  value="1"
                  id="quantity"
                />
                <button
                  class="btn btn-outline-secondary quantity-btn"
                  type="button"
                  onclick="updateQuantity(1)"
                >
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>
            <div class="col-md-8">
              <form method="POST" action="{% url 'add_to_cart' product.id %}" id="addToCartForm">
                {% csrf_token %}
                <input type="hidden" name="quantity" id="hiddenQuantity" value="1">
                <button
                  type="submit"
                  class="btn btn-primary btn-lg w-100"
                >
                  <i class="fas fa-cart-plus me-2"></i>
                  Add to Cart - £<span id="totalPrice"
                    >{{ product.price|default:"129.99" }}</span
                  >
                </button>
              </form>
            </div>
          </div>

          <div class="mt-3">
            <button
              class="btn btn-outline-primary w-100 mb-2"
              onclick="buyNow()"
            >
              <i class="fas fa-bolt me-2"></i>
              Buy Now with Express Delivery
            </button>
            <button
              class="btn btn-outline-secondary w-100"
              onclick="addToWishlist()"
            >
              <i class="far fa-heart me-2"></i>
              Add to Wishlist
            </button>
          </div>
        </div>

        <!-- Delivery Info -->
        <div class="delivery-info mb-5">
          <div class="card border-0 bg-light">
            <div class="card-body">
              <h5 class="card-title mb-3">
                <i class="fas fa-shipping-fast text-primary me-2"></i>
                Delivery Information
              </h5>
              <div class="row">
                <div class="col-md-6">
                  <p class="mb-1">
                    <i class="fas fa-check text-success me-2"></i>
                    Free standard delivery
                  </p>
                  <p class="mb-1">
                    <i class="fas fa-check text-success me-2"></i>
                    Dispatched in 24 hours
                  </p>
                </div>
                <div class="col-md-6">
                  <p class="mb-1">
                    <i class="fas fa-check text-success me-2"></i>
                    Express delivery available
                  </p>
                  <p class="mb-1">
                    <i class="fas fa-check text-success me-2"></i>
                    30-day free returns
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Tabs -->
  <div class="row mt-5">
    <div class="col-12">
      <ul class="nav nav-tabs" id="productTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="specs-tab"
            data-bs-toggle="tab"
            data-bs-target="#specs"
            type="button"
          >
            <i class="fas fa-list-alt me-2"></i>Specifications
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="reviews-tab"
            data-bs-toggle="tab"
            data-bs-target="#reviews"
            type="button"
          >
            <i class="fas fa-star me-2"></i>Reviews (128)
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="faq-tab"
            data-bs-toggle="tab"
            data-bs-target="#faq"
            type="button"
          >
            <i class="fas fa-question-circle me-2"></i>FAQ
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="warranty-tab"
            data-bs-toggle="tab"
            data-bs-target="#warranty"
            type="button"
          >
            <i class="fas fa-shield-alt me-2"></i>Warranty
          </button>
        </li>
      </ul>

      <div
        class="tab-content p-4 border border-top-0 rounded-bottom"
        id="productTabsContent"
      >
        <!-- Specifications Tab -->
        <div class="tab-pane fade show active" id="specs" role="tabpanel">
          <div class="row">
            <div class="col-md-6">
              <table class="table">
                <tbody>
                  <tr>
                    <th scope="row">Brand</th>
                    <td>AudioMaster</td>
                  </tr>
                  <tr>
                    <th scope="row">Model</th>
                    <td>AM-3000 Pro</td>
                  </tr>
                  <tr>
                    <th scope="row">Connectivity</th>
                    <td>Bluetooth 5.2</td>
                  </tr>
                  <tr>
                    <th scope="row">Battery Life</th>
                    <td>30 hours</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="col-md-6">
              <table class="table">
                <tbody>
                  <tr>
                    <th scope="row">Noise Cancelling</th>
                    <td>Active Noise Cancellation</td>
                  </tr>
                  <tr>
                    <th scope="row">Charging Time</th>
                    <td>2 hours (Quick Charge)</td>
                  </tr>
                  <tr>
                    <th scope="row">Weight</th>
                    <td>265g</td>
                  </tr>
                  <tr>
                    <th scope="row">Warranty</th>
                    <td>2 Years</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Reviews Tab -->
        <div class="tab-pane fade" id="reviews" role="tabpanel">
          <div class="row">
            <div class="col-md-4">
              <div class="text-center p-4 bg-light rounded">
                <h2 class="display-4 fw-bold text-primary">4.5</h2>
                <div class="stars text-warning mb-2">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star-half-alt"></i>
                </div>
                <p class="text-muted">Based on 128 reviews</p>
              </div>
            </div>
            <div class="col-md-8">
              <div class="review-list">
                <div class="review-item mb-4">
                  <div class="d-flex justify-content-between mb-2">
                    <div>
                      <strong>Alex Johnson</strong>
                      <div class="stars text-warning">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                      </div>
                    </div>
                    <span class="text-muted">2 days ago</span>
                  </div>
                  <p>
                    "Absolutely love these headphones! The noise cancellation is
                    incredible."
                  </p>
                </div>
                <div class="review-item mb-4">
                  <div class="d-flex justify-content-between mb-2">
                    <div>
                      <strong>Sarah Williams</strong>
                      <div class="stars text-warning">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="far fa-star"></i>
                      </div>
                    </div>
                    <span class="text-muted">1 week ago</span>
                  </div>
                  <p>
                    "Great sound quality, comfortable for long sessions. Battery
                    life is amazing!"
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- FAQ Tab -->
        <div class="tab-pane fade" id="faq" role="tabpanel">
          <div class="accordion" id="faqAccordion">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button
                  class="accordion-button"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#faq1"
                >
                  What's included in the box?
                </button>
              </h2>
              <div
                id="faq1"
                class="accordion-collapse collapse show"
                data-bs-parent="#faqAccordion"
              >
                <div class="accordion-body">
                  Headphones, charging cable, USB-C adapter, carrying case, and
                  user manual.
                </div>
              </div>
            </div>
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button
                  class="accordion-button collapsed"
                  type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#faq2"
                >
                  Is the warranty international?
                </button>
              </h2>
              <div
                id="faq2"
                class="accordion-collapse collapse"
                data-bs-parent="#faqAccordion"
              >
                <div class="accordion-body">
                  Yes, our 2-year warranty is valid in all countries we ship to.
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Warranty Tab -->
        <div class="tab-pane fade" id="warranty" role="tabpanel">
          <div class="alert alert-success">
            <h5>
              <i class="fas fa-shield-alt me-2"></i>2-Year Comprehensive
              Warranty
            </h5>
            <p>
              Your purchase is protected by our comprehensive warranty covering
              manufacturing defects and performance issues.
            </p>
          </div>
          <p>
            For warranty claims, please contact our support team with your order
            number and proof of purchase.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Related Products -->
  <div class="row mt-5">
    <div class="col-12">
      <h3 class="mb-4">You May Also Like</h3>
      <div class="row">
        <div class="col-md-3 col-sm-6 mb-4">
          <div class="card h-100">
            <img
              src="https://images.unsplash.com/photo-1590658165737-15a0472108b8?w=400&h=300&fit=crop"
              class="card-img-top"
              alt="Wireless Earbuds"
            />
            <div class="card-body">
              <h6 class="card-title">Wireless Earbuds Pro</h6>
              <p class="card-text text-primary fw-bold">£89.99</p>
              <a href="#" class="btn btn-outline-primary btn-sm w-100"
                >View Details</a
              >
            </div>
          </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-4">
          <div class="card h-100">
            <img
              src="https://images.unsplash.com/photo-1546435770-a3e426bf472b?w=400&h=300&fit=crop"
              class="card-img-top"
              alt="Bluetooth Speaker"
            />
            <div class="card-body">
              <h6 class="card-title">Bluetooth Speaker</h6>
              <p class="card-text text-primary fw-bold">£59.99</p>
              <a href="#" class="btn btn-outline-primary btn-sm w-100"
                >View Details</a
              >
            </div>
          </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-4">
          <div class="card h-100">
            <img
              src="https://images.unsplash.com/photo-1618366712010-f4ae9c647dcb?w=400&h=300&fit=crop"
              class="card-img-top"
              alt="Gaming Headset"
            />
            <div class="card-body">
              <h6 class="card-title">Gaming Headset</h6>
              <p class="card-text text-primary fw-bold">£79.99</p>
              <a href="#" class="btn btn-outline-primary btn-sm w-100"
                >View Details</a
              >
            </div>
          </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-4">
          <div class="card h-100">
            <img
              src="https://images.unsplash.com/photo-1546868871-7041f2a55e12?w=400&h=300&fit=crop"
              class="card-img-top"
              alt="USB-C Dock"
            />
            <div class="card-body">
              <h6 class="card-title">USB-C Dock</h6>
              <p class="card-text text-primary fw-bold">£49.99</p>
              <a href="#" class="btn btn-outline-primary btn-sm w-100"
                >View Details</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Custom CSS for Product Page -->
<style>
  .thumbnail {
    border: 2px solid transparent;
    border-radius: 8px;
    padding: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .thumbnail.active {
    border-color: #2563eb;
  }

  .thumbnail img {
    border-radius: 6px;
  }

  .color-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .color-option.active {
    background-color: rgba(37, 99, 235, 0.1);
    border: 2px solid #2563eb;
  }

  .color-circle {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    margin-bottom: 4px;
    border: 2px solid #e2e8f0;
  }

  .quantity-btn {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .quantity-btn:hover {
    background-color: #f8fafc;
    border-color: #2563eb;
  }

  .quantity-input {
    width: 60px;
    text-align: center;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 8px;
  }

  .product-rating .stars {
    font-size: 1.2rem;
  }

  .category-badge {
    background-color: rgba(37, 99, 235, 0.1);
    color: #2563eb;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
  }

  .review-item {
    padding: 16px;
    border-bottom: 1px solid #e2e8f0;
  }

  .review-item:last-child {
    border-bottom: none;
  }

  .cursor-pointer {
    cursor: pointer;
  }
</style>

<!-- JavaScript for Product Page -->
<script>
  // Image Gallery
  function changeImage(element, newSrc) {
    // Update main image
    document.getElementById("mainProductImage").src = newSrc;

    // Update active thumbnail
    document.querySelectorAll(".thumbnail").forEach((thumb) => {
      thumb.classList.remove("active");
    });
    element.classList.add("active");
  }

  // Quantity Control
  function updateQuantity(change) {
    const quantityInput = document.getElementById("quantity");
    let currentQuantity = parseInt(quantityInput.value);
    let newQuantity = currentQuantity + change;

    if (newQuantity < 1) newQuantity = 1;
    if (newQuantity > 10) newQuantity = 10;

    quantityInput.value = newQuantity;
    updateTotalPrice(newQuantity);
  }

  // Update Total Price - FIXED VERSION
  function updateTotalPrice(quantity) {
    // Get price from data attribute
    const priceElement = document.getElementById("productData");
    if (priceElement) {
      const unitPrice = parseFloat(priceElement.dataset.price);
      const totalPrice = unitPrice * quantity;
      document.getElementById("totalPrice").textContent = totalPrice.toFixed(2);
    } else {
      // Fallback
      const unitPrice = 129.99;
      const totalPrice = unitPrice * quantity;
      document.getElementById("totalPrice").textContent = totalPrice.toFixed(2);
    }
  }

  // Add to Cart
  function addToCart() {
    const quantity = document.getElementById("quantity").value;
    const form = document.getElementById("addToCartForm");
    const hiddenQuantity = document.getElementById("hiddenQuantity");
    
    // Update hidden quantity field
    hiddenQuantity.value = quantity;
    
    // Submit form
    form.submit();
  }

  // Buy Now
  function buyNow() {
    // Add to cart first, then redirect to checkout
    const quantity = document.getElementById("quantity").value;
    const form = document.getElementById("addToCartForm");
    const hiddenQuantity = document.getElementById("hiddenQuantity");
    
    hiddenQuantity.value = quantity;
    
    // Submit form and redirect to checkout
    fetch(form.action, {
      method: 'POST',
      headers: {
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
      },
      body: new FormData(form)
    })
    .then(() => {
      window.location.href = '/checkout/';
    });
  }

  // Add to Wishlist
  function addToWishlist() {
    alert("Added to wishlist!");
  }

  // Color Selection
  document.querySelectorAll(".color-option").forEach((option) => {
    option.addEventListener("click", function () {
      document.querySelectorAll(".color-option").forEach((opt) => {
        opt.classList.remove("active");
      });
      this.classList.add("active");
    });
  });

  // Initialize
  document.addEventListener("DOMContentLoaded", function () {
    updateTotalPrice(1);
  });
</script>
{% endblock %}
